/*
* videojs-ga - v0.4.1 - 2015-08-10
* Copyright (c) 2015 Michael Bensoussan
* Modified for Google Tag Manager by Isaac Abramowitz
* Licensed MIT
*/
(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};videojs.plugin("ga",function(t){var n,i,a,r,o,l,s,d,c,u,h,v,f,p,m,y,g,_,M,k,T,w,N,P,S,b,z,C,F,L,E,x,j,V;return null==t&&(t={}),S=document.createElement("a"),S.href=document.referrer,self!==top&&"preview-players.brightcove.net"===window.location.host&&(S.hostname="studio.brightcove.com")?void videojs.log("GTM plugin will not track events in Video Cloud Studio"):(P=this,a={},this.options()["data-setup"]&&(M=JSON.parse(this.options()["data-setup"]),M.ga&&(a=M.ga)),o=["player_load","video_load","percent_played","start","end","seek","play","pause","resize","volume_change","error","fullscreen"],v=t.eventsToTrack||a.eventsToTrack||o,w=t.percentsPlayedInterval||a.percentsPlayedInterval||25,c=t.eventCategory||a.eventCategory||"Brightcove Player",r=t.eventLabel||a.eventLabel,T=[],x=!1,s=!1,C=z=0,F=!1,u="",i="",h={video_load:"Video Load",percent_played:"Percent played",start:"Media Begin",seek_start:"Seek start",seek_end:"Seek end",play:"Media Play",pause:"Media Pause",error:"Error",fullscreen_exit:"Fullscreen Exited",fullscreen_enter:"Fullscreen Entered",resize:"Resize",volume_change:"Volume Change",player_load:"Player Load",end:"Media Complete"},p=function(e){return t.eventNames&&t.eventNames[e]?t.eventNames[e]:a.eventNames&&a.eventNames[e]?a.eventNames[e]:h[e]?h[e]:e},n=/(\s|^)vjs-ad-(playing|loading)(\s|$)/,g=function(e){return n.test(e.el().className)},_=function(){g(P)||(u=r?r:P.mediainfo&&P.mediainfo.id?P.mediainfo.id+" | "+P.mediainfo.name:this.currentSrc().split("/").slice(-1)[0].replace(/\.(\w{3,4})(\?.*)?$/i,""),P.mediainfo&&P.mediainfo.id&&P.mediainfo.id!==i&&(i=P.mediainfo.id,T=[],x=!1,s=!1,C=z=0,F=!1,e.call(v,"video_load")>=0&&L(p("video_load"),!0)))},j=function(){var t,n,i,a,r;if(!g(P)){for(t=Math.round(this.currentTime()),n=Math.round(this.duration()),a=Math.round(t/n*100),i=r=w;99>=r;i=r+=w)a>=i&&e.call(T,i)<0&&(e.call(v,"percent_played")>=0&&0!==a&&L(i+"% Milestone Passed",!0),a>0&&T.push(i));e.call(v,"seek")>=0&&(C=z,z=t,Math.abs(C-z)>1&&(F=!0,L(p("seek_start"),!1,C),L(p("seek_end"),!1,z)))}},l=function(){g(P)||s||(L(p("end"),!0),s=!0)},N=function(){var e;g(P)||(e=Math.round(this.currentTime()),L(p("play"),!0,e),F=!1)},E=function(){return!g(P)&&e.call(v,"start")>=0&&!x?(L(p("start"),!0),x=!0):void 0},k=function(){var e,t;g(P)||(e=Math.round(this.currentTime()),t=Math.round(this.duration()),e===t||F||L(p("pause"),!0,e))},V=function(){var e;e=this.muted()===!0?0:this.volume(),L(p("volume_change"),!1,e)},b=function(){L(p("resize")+" - "+this.width()+"*"+this.height(),!0)},d=function(){var e;e=Math.round(this.currentTime()),L(p("error"),!0,e)},f=function(){var e;e=Math.round(this.currentTime()),("function"==typeof this.isFullscreen?this.isFullscreen():void 0)||("function"==typeof this.isFullScreen?this.isFullScreen():void 0)?L(p("fullscreen_enter"),!1,e):L(p("fullscreen_exit"),!1,e)},L=function(e){dataLayer.push({videoCategory:c,videoAction:e,videoLabel:u,event:"videoEvent"})},e.call(v,"player_load")>=0&&(self!==top?(m=document.referrer,y=1):(m=window.location.href,y=0)),void this.ready(function(){return this.on("loadedmetadata",_),this.on("timeupdate",j),e.call(v,"end")>=0&&this.on("ended",l),e.call(v,"play")>=0&&this.on("play",N),e.call(v,"start")>=0&&this.on("playing",E),e.call(v,"pause")>=0&&this.on("pause",k),e.call(v,"volume_change")>=0&&this.on("volumechange",V),e.call(v,"resize")>=0&&this.on("resize",b),e.call(v,"error")>=0&&this.on("error",d),e.call(v,"fullscreen")>=0?this.on("fullscreenchange",f):void 0}))})}).call(this);